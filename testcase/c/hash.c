#include "trap.h"
#define MAX_SIZE 1234
#define MOD 1003

#define DELETE -1
#define EMPTY 0

char real[MAX_SIZE];
char test_data[MAX_SIZE] = {103, -58, 105, 115, 81, -1, 74, -20, 41, -51, -70, -85, -14, -5, -29, 70, 124, -62, 84, -8, 27, -24, -25, -115, 118, 90, 46, 99, 51, -97, -55, -102, 102, 50, 13, -73, 49, 88, -93, 90, 37, 93, 5, 23, 88, -23, 94, -44, -85, -78, -51, -58, -101, -76, 84, 17, 14, -126, 116, 65, 33, 61, -36, -121, 112, -23, 62, -95, 65, -31, -4, 103, 62, 1, 126, -105, -22, -36, 107, -106, -113, 56, 92, 42, -20, -80, 59, -5, 50, -81, 60, 84, -20, 24, -37, 92, 2, 26, -2, 67, -5, -6, -86, 58, -5, 41, -47, -26, 5, 60, 124, -108, 117, -40, -66, 97, -119, -7, 92, -69, -88, -103, 15, -107, -79, -21, -15, -77, 5, -17, -9, 0, -23, -95, 58, -27, -54, 11, -53, -48, 72, 71, 100, -67, 31, 35, 30, -88, 28, 123, 100, -59, 20, 115, 90, -59, 94, 75, 121, 99, 59, 112, 100, 36, 17, -98, 9, -36, -86, -44, -84, -14, 27, 16, -81, 59, 51, -51, -29, 80, 72, 71, 21, 92, -69, 111, 34, 25, -70, -101, 125, -11, 11, -31, 26, 28, 127, 35, -8, 41, -8, -92, 27, 19, -75, -54, 78, -24, -104, 50, 56, -32, 121, 77, 61, 52, -68, 95, 78, 119, -6, -53, 108, 5, -84, -122, 33, 43, -86, 26, 85, -94, -66, 112, -75, 115, 59, 4, 92, -45, 54, -108, -77, -81, -30, -16, -28, -98, 79, 50, 21, 73, -3, -126, 78, -87, 8, 112, -44, -78, -118, 41, 84, 72, -102, 10, -68, -43, 14, 24, -88, 68, -84, 91, -13, -114, 76, -41, 45, -101, 9, 66, -27, 6, -60, 51, -81, -51, -93, -124, 127, 45, -83, -44, 118, 71, -34, 50, 28, -20, 74, -60, 48, -10, 32, 35, -123, 108, -5, -78, 7, 4, -12, -20, 11, -71, 32, -70, -122, -61, 62, 5, -15, -20, -39, 103, 51, -73, -103, 80, -93, -29, 20, -45, -39, 52, -9, 94, -96, -14, 16, -88, -10, 5, -108, 1, -66, -76, -68, 68, 120, -6, 73, 105, -26, 35, -48, 26, -38, 105, 106, 126, 76, 126, 81, 37, -77, 72, -124, 83, 58, -108, -5, 49, -103, -112, 50, 87, 68, -18, -101, -68, -23, -27, 37, -49, 8, -11, -23, -30, 94, 83, 96, -86, -46, -78, -48, -123, -6, 84, -40, 53, -24, -44, 102, -126, 100, -104, -39, -88, -121, 117, 101, 112, 90, -118, 63, 98, -128, 41, 68, -34, 124, -91, -119, 78, 87, 89, -45, 81, -83, -84, -122, -107, -128, -20, 23, -28, -123, -15, -116, 12, 102, -15, 124, -64, 124, -69, 34, -4, -28, 102, -38, 97, 11, 99, -81, 98, -68, -125, -76, 105, 47, 58, -1, -81, 39, 22, -109, -84, 7, 31, -72, 109, 17, 52, 45, -115, -17, 79, -119, -44, -74, 99, 53, -63, -57, -28, 36, -125, 103, -40, -19, -106, 18, -20, 69, 57, 2, -40, -27, 10, -8, -99, 119, 9, -47, -91, -106, -63, -12, 31, -107, -86, -126, -54, 108, 73, -82, -112, -51, 22, 104, -70, -84, 122, -90, -14, -76, -88, -54, -103, -78, -62, 55, 42, -53, 8, -49, 97, -55, -61, -128, 94, 110, 3, 40, -38, 76, -41, 106, 25, -19, -46, -45, -103, 76, 121, -117, 0, 34, 86, -102, -44, 24, -47, -2, -28, -39, -51, 69, -93, -111, -58, 1, -1, -55, 42, -39, 21, 1, 67, 47, -18, 21, 2, -121, 97, 124, 19, 98, -98, 105, -4, 114, -127, -51, 113, 101, -90, 62, -85, 73, -49, 113, 75, -50, 58, 117, -89, 79, 118, -22, 126, 100, -1, -127, -21, 97, -3, -2, -61, -101, 103, -65, 13, -23, -116, 126, 78, 50, -67, -7, 124, -116, 106, -57, 91, -92, 60, 2, -12, -78, -19, 114, 22, -20, -13, 1, 77, -16, 0, 16, -117, 103, -49, -103, 80, 91, 23, -97, -114, -44, -104, 10, 97, 3, -47, -68, -89, 13, -66, -101, -65, -85, 14, -43, -104, 1, -42, -27, -14, -42, -10, 125, 62, -59, 22, -114, 33, 46, 45, -81, 2, -58, -71, 99, -55, -118, 31, 112, -105, -34, 12, 86, -119, 26, 43, 33, 27, 1, 7, 13, -40, -3, -117, 22, -62, -95, -92, -29, -49, -46, -110, -46, -104, 75, 53, 97, -43, 85, -47, 108, 51, -35, -62, -68, -9, -19, -34, 19, -17, -27, 32, -57, -30, -85, -35, -92, 77, -127, -120, 28, 83, 26, -18, -21, 102, 36, 76, 59, 121, 30, -88, -84, -5, 106, 104, -13, 88, 70, 6, 71, 43, 38, 14, 13, -46, -21, -78, 31, 108, 58, 59, -64, 84, 42, -85, -70, 78, -8, -10, -57, 22, -98, 115, 17, 8, -37, 4, 96, 34, 10, -89, 77, 49, -75, 91, 3, -96, 13, 34, 13, 71, 93, -51, -101, -121, 120, 86, -43, 112, 76, -100, -122, -22, 15, -104, -14, -21, -100, 83, 13, -89, -6, 90, -40, -80, -75, -37, 80, -62, -3, 93, 9, 90, 42, -91, -30, -93, -5, -73, 19, 71, 84, -102, 49, 99, 50, 35, 78, -50, 118, 91, 117, 113, -74, 77, 33, 107, 40, 113, 46, 37, -49, 55, -128, -7, -36, 98, -100, -41, 25, -80, 30, 109, 74, 79, -47, 124, 115, 31, 74, -23, 123, -64, 90, 49, 13, 123, -100, 54, -19, -54, 91, -68, 2, -37, -75, -34, 61, 82, -74, 87, 2, -44, -60, 76, 36, -107, -56, -105, -75, 18, -128, 48, -46, -37, 97, -32, 86, -3, 22, 67, -56, 113, -1, -54, 77, -75, -88, -118, 7, 94, -31, 9, 51, -90, 85, 87, 59, 29, -18, -16, 47, 110, 32, 2, 73, -127, -30, -96, 127, -8, -29, 71, 105, -29, 17, -74, -104, -71, 65, -97, 24, 34, -88, 75, -56, -3, -94, 4, 26, -112, -12, 73, -2, 21, 75, 72, -106, 45, -24, 21, 37, -53, 92, -113, -82, 109, 69, 70, 39, -122, -27, 63, -87, -115, -118, 113, -118, 44, 117, -92, -68, 106, -18, -70, 127, 57, 2, 21, 103, -22, 43, -116, -74, -121, 27, 100, -11, 97, -85, 28, -25, -112, 91, -112, 30, -27, 2, -88, 17, 119, 77, -51, -31, 59, -121, 96, 116, -118, 118, -37, 116, -95, 104, 42, 40, -125, -113, 29, -28, 58, 57, -52, -54, -108, 92, -24, 121, 94, -111, -118, -42, -34, 87, -73, 25, -33, 24, -115, 105, -114, 105, -35, 47, -47, 8, 87, 84, -105, 117, 57, -47, -82, 5, -101, 67, 97, -124, -68, -64, 21, 71, -106, -13, -98, 77, 12, 125, 101, -103, -26, -13, 2, -60, 34, -45, -52, 122, 40, 99, -17, 97, 52, -99, 102, -49, -32, -57, 83, -99, -121, 104, -28, 29, 91, -126, 107, 103, 0, -48, 1, -26, -60, 3, -86, -26, -41, 118, 96, -1, -39, 79, 96, 13, -19, -58, -35, -51, -115, 48, 106, 21, -103, 78, 50, -12, -47, -99, 92, -47, 110, 93, -73, 50, 96, 98, 24, 55, -40, 121, 54, -78, -56, -106, -65, -75, 92, -100, -125, -22, -51, -19, -1, 102, 60, 49, 90, 13, -49, -74, -34, 61, 19, -107, 111, 116, -9, -121, -85, -48, 0, -30, -126, -55, 120, 65, 126, -43, -34, 1, -65, -85, -17, -66, 17, 43, -17, 107, 56, -66, 34 };

typedef struct {
    char value;
    char ref;
}Element;

Element barrier[MAX_SIZE];

void init_barrier(Element* barrier) 
{
	int i;
	for (i = 0; i < MAX_SIZE; i ++) {
		barrier[i].value = 0;
		barrier[i].ref = 0;
	}
}

void insert_barrier(Element* barrier, char element) 
{
    int dst = element % MOD;
    int i = 1;
    int pos = dst;
    while (barrier[pos].ref != EMPTY) {
	if (barrier[pos].ref == DELETE) break;
	i ++;
	pos = (pos + 1) % MAX_SIZE;
	if (pos == dst) break;
    }

    if (pos == dst && barrier[pos].ref != EMPTY && barrier[pos].ref != DELETE) {
	return;
    }

    barrier[pos].value = element;
    barrier[pos].ref = i;
}

int main() 
{
	int i;
    init_barrier(barrier);
    for (i = 0; i < MAX_SIZE; i ++) {
		insert_barrier(barrier, test_data[i]);
    }

	for (i = 0; i < MAX_SIZE; i ++) {
		nemu_assert(real[i] == barrier[i].value);
	}
    return 0;
}
char real[] = {-76, -126, -36, -121, -23, 5, -95, -31, -4, 1, -105, -22, -36, 13, 14, -106, -113, 17, -20, -80, -5, -81, -20, 23, 24, -37, 2, 27, 26, -2, -5, -6, -86, 33, -5, -47, -26, 37, 5, -108, -40, 41, 42, 41, -66, -119, 46, -7, -69, 49, 50, 51, 50, -88, -103, 15, 56, -107, 58, 59, 60, 61, 62, 62, 60, 65, 65, 67, -79, -21, 70, -15, -77, 5, 74, -17, -9, 0, -23, -95, 58, 81, -27, -54, 84, 84, 84, 11, 88, 88, 90, 90, 92, 93, 94, 92, 92, 97, -53, 99, -48, 72, 102, 103, 103, 105, 71, 107, 100, -67, 31, 35, 112, 30, -88, 115, 116, 117, 118, 28, 100, -59, 20, 123, 124, 124, 126, 115, 90, -59, 94, 75, 121, 99, 59, 112, 100, 36, 17, -98, 9, -36, -86, -44, -84, -14, 27, 16, -81, 59, 51, -51, -29, 80, 72, 71, 21, 92, -69, 111, 34, 25, -70, -101, 125, -11, 11, -31, 26, 28, 127, 35, -8, 41, -8, -92, 27, 19, -75, -54, 78, -24, -104, 50, 56, -32, 121, 77, 61, 52, -68, 95, 78, 119, -6, -53, 108, 5, -84, -122, 33, 43, -86, 26, 85, -94, -66, 112, -75, 115, 59, 4, 92, -45, 54, -108, -77, -81, -30, -16, -28, -98, 79, 50, 21, 73, -3, -126, 78, -87, 8, 112, -44, -78, -118, 41, 84, 72, -102, 10, -68, -43, 14, 24, -88, 68, -84, 91, -13, -114, 76, -41, 45, -101, 9, 66, -27, 6, -60, 51, -81, -51, -93, -124, 127, 45, -83, -44, 118, 71, -34, 50, 28, -20, 74, -60, 48, -10, 32, 35, -123, 108, -5, -78, 7, 4, -12, -20, 11, -71, 32, -70, -122, -61, 62, 5, -15, -20, -39, 103, 51, -73, -103, 80, -93, -29, 20, -45, -39, 52, -9, 94, -96, -14, 16, -88, -10, 5, -108, 1, -66, -76, -68, 120, -6, 73, 105, -26, 35, -48, 26, -38, 105, 106, 126, 76, 126, 81, 37, -77, 72, -124, 83, 58, -108, -5, 49, -103, -112, 50, 87, 68, -18, -101, -68, -23, -27, 37, -49, 8, -11, -23, -30, 94, 83, 96, -86, -46, -78, -48, -123, -6, 84, -40, 53, -24, -44, 102, -126, 100, -104, -39, -88, -121, 117, 101, 112, 90, -118, 63, 98, -128, 41, 68, -34, 124, -91, -119, 78, 87, 89, -45, 81, -83, -84, -122, -107, -128, -20, 23, -28, -123, -15, -116, 12, 102, -15, 124, -64, 124, -69, 34, -4, -28, 102, -38, 97, 11, 99, 98, -68, -125, -76, 105, 47, 58, -1, -81, 39, 22, -109, -84, 7, 31, -72, 109, 17, 52, 45, -115, -17, 79, -119, -44, -74, 99, 53, -63, -57, -28, 36, -125, 103, -40, -19, -106, 18, -20, 69, 57, 2, -27, 10, -8, -99, 119, 9, -47, -91, -106, -63, -12, 31, -107, -86, -126, -54, 108, 73, -82, -112, -51, 22, 104, -70, -84, 122, -90, -14, -76, -88, -54, -103, -78, -62, 55, 42, -53, 8, -49, 97, -55, -61, -128, 94, 110, 3, 40, -38, 76, -41, 106, 25, -19, -46, -45, -103, 76, 121, -117, 0, 34, 86, -102, -44, -47, -2, -28, -39, -51, 69, -93, -111, -58, 1, -1, -55, 42, -39, 21, 1, 67, 47, -18, 21, 2, -121, 97, 124, 19, 98, -98, 105, -4, 114, -127, -51, 113, 101, -90, 62, -85, 73, -49, 113, 75, -50, 58, 117, -89, 79, 118, -22, 126, 100, -1, -127, -21, 97, -3, -2, -61, -101, 103, -65, 13, -23, -116, 126, 78, 50, -67, -7, 124, -116, 106, -57, 91, -92, 60, 2, -12, -78, -19, 114, 22, -20, -13, 1, 77, -16, 0, 16, -117, 103, -49, -103, 80, 91, 23, -97, -114, -44, -104, 10, 97, 3, -47, -68, -89, 13, -66, -101, -65, -85, 14, -43, -104, 1, -42, -27, -14, -42, -10, 125, 62, -59, 22, -114, 33, 46, 45, -81, 2, -58, -71, 99, -55, -118, 31, 112, -105, -34, 12, 86, -119, 26, 43, 33, 27, 1, 7, 13, -40, -3, -117, 22, -62, -95, -92, -29, -49, -46, -110, -46, -104, 75, 53, 97, -43, 85, -47, 108, 51, -35, -68, -9, -19, -34, 19, -17, -27, 32, -57, -30, -85, -35, -92, 77, -127, -120, 28, 83, 26, -18, -21, 102, 36, 76, 59, 121, 30, -88, -84, -5, 106, 104, -13, 88, 70, 6, 71, 43, 38, 14, 13, -46, -21, -78, 31, 108, 58, 59, -64, 84, 42, -85, -70, 78, -10, -57, 22, -98, 115, 17, 8, -37, 4, 96, 34, 10, -89, 77, 49, -75, 91, 3, -96, 13, 34, 71, 93, -51, -101, -121, 120, 86, -43, 112, 76, -100, -122, -22, 15, -104, -14, -21, -100, 83, 13, -89, -6, 90, -40, -80, -75, -37, 80, -62, -3, 93, 9, 90, 42, -91, -30, -93, -5, -73, 19, 71, 84, -102, 49, 99, 50, 35, 78, -50, 118, 91, 117, 113, -74, 77, 33, 107, 40, 113, 46, 37, -49, 55, -128, -7, -36, 98, -100, -41, 25, -80, 30, 109, 74, 79, -47, 124, 115, 31, 74, -23, 123, -64, 90, 49, 13, 123, -100, 54, -19, -54, 91, -68, 2, -37, -75, -34, 61, 82, -74, 87, 2, -44, -60, 76, 36, -107, -56, -105, -75, 18, -128, 48, -46, -37, 97, -32, 86, -3, 22, 67, -56, 113, -1, -54, 77, -75, -88, -118, 7, 94, -31, 9, 51, -90, 85, 87, 59, 29, -18, -16, 47, 110, 32, 2, 73, -127, -30, -96, 127, -8, -29, 71, 105, -29, 17, -74, -104, -71, 65, -97, 24, 34, -88, 75, -56, -3, -94, 4, 26, -112, -12, 73, -2, 21, 75, 72, -106, 45, -24, 21, 37, -53, 92, -113, -82, 109, 69, 70, 39, -122, -27, 63, -87, -115, -118, 113, -118, 44, 117, -92, -68, 106, -18, -70, 127, 57, 2, 21, 103, -22, 43, -116, -74, -121, 27, 100, -11, 97, -85, 28, -25, -112, 91, -112, 30, -27, 2, -88, 17, 119, 77, -51, -31, 59, -121, 96, 116, -118, 118, -37, 116, -95, 104, 42, 40, -125, -113, 29, -28, 58, 57, -52, -54, -108, 92, -24, 121, 94, -111, -118, -42, -34, 87, -73, 25, -33, -115, 105, -114, 105, -35, 47, -47, 8, 87, 84, -105, 117, 57, -47, -82, 5, -101, 67, 97, -124, -68, -64, 21, 71, -106, -13, -98, 77, 12, 125, 101, -103, -26, -13, 2, -60, 34, -45, -52, 122, 40, 99, -17, 97, 52, -99, 102, -49, -32, -57, 83, -99, -121, 104, -28, 29, 91, -126, 107, -70, 1, -48, 1, -26, -60, 3, -86, -26, -41, 118, 96, -1, -39, 79, 96, 13, -19, -58, -35, -51, -115, 48, 21, -103, 78, 50, -12, -47, -99, 92, -47, 110, 93, -73, 50, 96, 98, 24, 55, -40, 121, 54, -78, -56, -106, -65, -75, 92, -100, -125, -22, -51, -58, 16, 102, 60, 49, 90, 13, -49, -74, -34, 61, 19, 111, 116, -9, -121, -85, -51, 18, -30, -126, -55, 120, 65, 126, -43, -34, 1, -65, -85, -17, -66, 17, 43, -17, 107, 56, -66, 34, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 };
